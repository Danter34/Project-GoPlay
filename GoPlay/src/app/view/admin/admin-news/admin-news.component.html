<div class="dashboard-container">
  <div class="action-header">
     <h5 class="m-0 font-weight-bold text-primary">Quản lý Tin Tức</h5>
    <button class="btn-create" (click)="openCreate()">
      <i class="fas fa-plus"></i> Đăng tin mới
    </button>
  </div>

  <div class="table-responsive">
    <table class="table custom-table">
      <thead>
        <tr>
          <th>ID</th>
          <th style="width: 100px;">Hình ảnh</th>
          <th style="width: 35%;">Tiêu đề bài viết</th>
          <th>Ngày đăng</th>
          <th>Trạng thái</th>
          <th>Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of newsList">
          <td><span style="font-weight: bold; color: #aaa;">#{{ item.id }}</span></td>
          <td>
            <img [src]="item.imageUrl ? ('https://apigplay.qzz.io' + item.imageUrl) : 'assets/placeholder.jpg'" 
                 class="thumb-img" alt="img" style="width: 60px; height: 40px; border-radius: 6px; object-fit: cover;">
          </td>
          <td>
            <div class="fw-bold" style="color: #2c3e50;">{{ item.title }}</div>
            <div class="text-muted small text-truncate" style="max-width: 250px;">{{ item.summary }}</div>
          </td>
          <td>
             <div style="font-size: 0.9rem; font-weight: 600; color: #555;">
                {{ item.createdAt | date:'dd/MM/yyyy' }}
             </div>
          </td>
          <td>
            <span class="badge" style="color: black;" [class.bg-success]="item.isPublished" [class.bg-secondary]="!item.isPublished">
              {{ item.isPublished ? 'Công khai' : 'Bản nháp' }}
            </span>
          </td>
          <td>
            <button class="btn-icon edit" (click)="openEdit(item)" title="Sửa"><i class="fas fa-pen"></i></button>
            <button class="btn-icon delete" (click)="deleteItem(item.id)" title="Xóa"><i class="fas fa-trash-alt"></i></button>
          </td>
        </tr>
        
        <tr *ngIf="newsList.length === 0 && !isLoading">
             <td colspan="6" class="text-center py-5" style="color: #999;">Chưa có bài viết nào.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-content modal-lg">
    
    <div class="modal-header">
      <h3>{{ isEditMode ? 'Chỉnh Sửa Bài Viết' : 'Soạn Bài Viết Mới' }}</h3>
      <button class="btn-close" (click)="closeModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group mb-3">
        <label>Tiêu đề <span class="text-danger">*</span></label>
        <input type="text" [(ngModel)]="formData.title" class="form-control" placeholder="Nhập tiêu đề hấp dẫn...">
      </div>

      <div class="form-group mb-3">
        <label>Ảnh bìa</label>
        <div style="display: flex; align-items: center; gap: 15px;">
            <input type="file" (change)="onFileSelected($event)" accept="image/*" class="form-control" style="width: auto;">
            
            <div class="position-relative" *ngIf="formData.imageUrl">
              <img [src]="'https://localhost:7000' + formData.imageUrl" class="img-preview" style="height: 60px; border-radius: 6px; border: 1px solid #ddd;">
              <button class="btn-remove-img" (click)="removeImage()" style="background: red; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; position: absolute; top: -5px; right: -5px; font-size: 10px; cursor: pointer;">&times;</button>
            </div>
        </div>
      </div>

      <div class="form-group mb-3">
        <label>Mô tả ngắn</label>
        <textarea [(ngModel)]="formData.summary" rows="2" class="form-control" placeholder="Hiển thị ở trang danh sách..."></textarea>
      </div>

      <div class="form-group mb-3">
        <label>Nội dung chi tiết <span class="text-danger">*</span></label>
        <textarea [(ngModel)]="formData.content" rows="8" class="form-control" placeholder="Viết nội dung đầy đủ..."></textarea>
      </div>

      <div class="form-group">
        <label class="checkbox-label" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
          <input type="checkbox" [(ngModel)]="formData.isPublished" style="width: 20px; height: 20px; cursor: pointer;"> 
          <span style="font-weight: 600; color: #2c3e50;">Hiển thị bài viết ngay</span>
        </label>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeModal()">Đóng</button>
      <button class="btn-save" (click)="onSubmit()">
        <i class="fas fa-check"></i> {{ isEditMode ? 'Lưu thay đổi' : 'Đăng bài' }}
      </button>
    </div>
  </div>
</div>